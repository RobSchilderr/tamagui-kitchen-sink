{
  "version": 3,
  "sources": ["../../src/LmAutocomplete.tsx"],
  "sourcesContent": ["import { Button, Input, ListItem, Popover, Sheet, ThemeName, XGroup, XStack } from 'tamagui'\nimport { CaretDown, CheckSquare, ListPlus, Square } from 'tamagui-phosphor-icons'\nimport { useDeferredValue, useEffect, useId, useRef, useState } from 'react'\nimport { LmFormFieldContainer } from './LmFormFieldContainer'\nimport { LmFormContainerBaseTypes } from './formContainerTypes'\nimport { LmPopover } from '@tamagui-extras/core'\nimport { Platform, useWindowDimensions } from 'react-native'\n\ntype Option = { label: string; value: string | number }\nexport type LmAutocompleteProps = LmFormContainerBaseTypes & {\n  options: Option[]\n  multiple?: boolean\n  value?: null | Option | Option[]\n  onChange?: (v: null | Option | Option[]) => void\n  placeholderSearch?: string\n  disableSearch?: boolean\n  theme?: ThemeName\n  allowNew?: boolean\n  allowNewHook?: (newValue: string) => Option\n}\n\ntype AutocompleteContext = {\n  onChangeSelection: (option: Option) => void\n  isSelected: (opts: Option) => boolean\n}\n\ntype ConditionalOption<T extends boolean> = T extends true ? Option[] : Option\n\nexport function LmAutocomplete({\n  options,\n  labelInline,\n  labelProps,\n  helperText,\n  helperTextProps,\n  required,\n  label,\n  value,\n  onChange,\n  error,\n  theme,\n  allowNewHook,\n  multiple = false,\n  ...rest\n}: LmAutocompleteProps) {\n  const id = useId()\n  const [opts, setOpts] = useState(options)\n  const { width } = useWindowDimensions()\n  const [popoverWidth, setPopoverWidth] = useState<number>(0)\n  const inputRef = useRef<HTMLInputElement>(null)\n  const [selection, setSelection] = useState<ConditionalOption<typeof multiple> | null>(\n    value ?? (multiple ? [] : null)\n  )\n  const isSelected = (item: Option) =>\n    Array.isArray(selection)\n      ? !!selection?.some((i) => i.value === item.value)\n      : selection?.value === item.value\n\n  const onChangeSelection = (item: Option) => {\n    let newVal: ConditionalOption<typeof multiple> | null = null\n    if (multiple) {\n      const has = isSelected(item)\n      newVal = has\n        ? (selection as Option[])?.filter((i) => i.value !== item.value) ?? []\n        : [...((selection as Option[]) ?? []), item]\n    } else {\n      newVal = isSelected(item) ? null : item\n    }\n    setSelection(newVal)\n    if (typeof onChange === 'function') {\n      onChange(newVal)\n    }\n  }\n\n  useEffect(() => {\n    const elWidth = inputRef.current?.offsetWidth\n    if (elWidth) {\n      setPopoverWidth(elWidth)\n    }\n  }, [width])\n\n  const inputValue = Array.isArray(selection)\n    ? selection.map((option) => option?.label).join(', ')\n    : selection?.label || ''\n\n  return (\n    <LmFormFieldContainer\n      id={id}\n      error={error}\n      required={required}\n      labelProps={labelProps}\n      label={label}\n      labelInline={labelInline}\n      helperText={helperText}\n      helperTextProps={helperTextProps}\n    >\n      <XGroup ref={inputRef}>\n        <XGroup.Item>\n          <Input flex={1} value={inputValue} theme={theme} textOverflow={'ellipsis'} />\n        </XGroup.Item>\n        <XGroup.Item>\n          <LmPopover\n            isBouncy\n            sheetProps={\n              {\n                // snapPoints: [100, 0],\n              }\n            }\n            contentProps={{\n              minWidth: popoverWidth ? popoverWidth : undefined,\n              maxWidth: '100%',\n            }}\n            trigger={\n              <Button icon={<CaretDown />} borderTopLeftRadius={0} borderBottomLeftRadius={0} />\n            }\n          >\n            <LmAutocompleteInputContent\n              theme={theme}\n              options={opts}\n              isSelected={isSelected}\n              onChangeSelection={onChangeSelection}\n              onAddNew={(newVal) => {\n                if (newVal) {\n                  const newItem =\n                    typeof allowNewHook === 'function'\n                      ? allowNewHook(newVal)\n                      : {\n                          value: newVal,\n                          label: newVal,\n                        }\n                  setOpts((oldVal) => [newItem, ...oldVal])\n                }\n              }}\n              {...rest}\n            />\n          </LmPopover>\n        </XGroup.Item>\n      </XGroup>\n    </LmFormFieldContainer>\n  )\n}\n\ntype LmAutocompleteInputContentProps = LmAutocompleteProps &\n  AutocompleteContext & {\n    onAddNew: (str: string) => void\n  }\n\nfunction LmAutocompleteInputContent({\n  disableSearch,\n  theme,\n  placeholderSearch,\n  options,\n  allowNew,\n  onAddNew,\n  onChangeSelection,\n  isSelected,\n}: LmAutocompleteInputContentProps) {\n  const [searchTerm, setSearchTerm] = useState<string>()\n  const deferredTerm = useDeferredValue(searchTerm)\n  const filteredOptions = deferredTerm?.length\n    ? options.filter((i) => i.label.toLowerCase().includes(deferredTerm))\n    : options\n  return (\n    <>\n      {Platform.OS === 'web' ? (\n        <>\n          {(!disableSearch || allowNew) && (\n            <XStack padding={'$4'} width={'100%'}>\n              <Input\n                theme={theme}\n                placeholder={placeholderSearch}\n                width={'100%'}\n                onChangeText={(text) => {\n                  setSearchTerm(text.toLowerCase())\n                }}\n              />\n            </XStack>\n          )}\n          <Popover.ScrollView\n            keyboardShouldPersistTaps={'always'}\n            style={{ maxHeight: 300, width: '100%' }}\n          >\n            <LmAutocompleteList\n              options={filteredOptions}\n              onChangeSelection={onChangeSelection}\n              isSelected={isSelected}\n            />\n            {allowNew && !filteredOptions?.length && deferredTerm && (\n              <XStack justifyContent={'flex-start'} marginBottom={'$3'} marginLeft={'$3'}>\n                <Button onPress={() => onAddNew(deferredTerm)} chromeless icon={<ListPlus />}>\n                  {deferredTerm}\n                </Button>\n              </XStack>\n            )}\n          </Popover.ScrollView>\n        </>\n      ) : (\n        <>\n          {(!disableSearch || allowNew) && (\n            <XStack padding={'$4'} width={'100%'}>\n              <Input\n                theme={theme}\n                placeholder={placeholderSearch}\n                width={'100%'}\n                onChangeText={(text) => {\n                  setSearchTerm(text.toLowerCase())\n                }}\n              />\n            </XStack>\n          )}\n          <Sheet.ScrollView>\n            <LmAutocompleteList\n              options={filteredOptions}\n              onChangeSelection={onChangeSelection}\n              isSelected={isSelected}\n            />\n          </Sheet.ScrollView>\n          {allowNew && !filteredOptions?.length && deferredTerm && (\n            <XStack justifyContent={'flex-start'} marginBottom={'$3'} marginLeft={'$3'}>\n              <Button onPress={() => onAddNew(deferredTerm)} chromeless icon={<ListPlus />}>\n                {deferredTerm}\n              </Button>\n            </XStack>\n          )}\n        </>\n      )}\n    </>\n  )\n}\n\ntype LmAutocompleteListProps = AutocompleteContext & {\n  options: LmAutocompleteProps['options']\n}\n\nfunction LmAutocompleteList({ options, isSelected, onChangeSelection }: LmAutocompleteListProps) {\n  return (\n    <>\n      {options.map((item, i) => {\n        return (\n          <ListItem\n            hoverTheme\n            key={item.value}\n            icon={isSelected(item) ? <CheckSquare /> : <Square />}\n            title={item.label}\n            onPress={() => onChangeSelection(item)}\n          />\n        )\n      })}\n    </>\n  )\n}\n"],
  "mappings": "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",
  "names": []
}
